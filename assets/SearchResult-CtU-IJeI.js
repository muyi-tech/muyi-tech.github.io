import{f as X,u as Z,g as M,h as ee,i as se,t as ae,j as le,k as S,l as C,m as a,n as te,p as U,s as ie,R as T,q as re,v as ue,x as ne,y as ce,z as oe,A as b,B as I,C as ve,D as de,E as he,F as ye,G as me,H as pe,I as ge,J as O,K as Ee,L as R}from"./app-DjmxX8QC.js";const fe=["/","/intro.html","/pages/e2788a/","/pages/ea5253/","/pages/dae193/","/pages/77c2ad/","/pages/743831/","/pages/3c49fc/","/pages/3a4779/","/pages/cf6c91/","/pages/26261c/","/404.html","/pages/","/category/","/category/tools/","/category/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/","/category/linux/","/category/%E9%9A%8F%E7%AC%94/","/category/%E6%AF%9B%E9%80%89/","/tag/","/tag/tools/","/tag/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/","/tag/linux/","/tag/%E5%B9%B8%E7%A6%8F%E4%B8%80%E5%88%BB/","/tag/%E9%9A%8F%E7%AC%94/","/tag/%E6%AF%9B%E9%80%89/","/tag/%E6%91%98%E6%8A%84/","/article/","/star/","/timeline/"],Ae="SLIMSEARCH_QUERY_HISTORY",p=O(Ae,[]),He=()=>{const{queryHistoryCount:t}=R;return{enabled:t>0,queryHistories:p,addQueryHistory:u=>{p.value=Array.from(new Set([u,...p.value.slice(0,t-1)]))},removeQueryHistory:u=>{p.value=[...p.value.slice(0,u),...p.value.slice(u+1)]}}},F=t=>fe[t.id]+("anchor"in t?`#${t.anchor}`:""),Ce="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=R,g=O(Ce,[]),Re=()=>({enabled:j>0,resultHistories:g,addResultHistory:r=>{{const u={link:F(r),display:r.display};"header"in r&&(u.header=r.header),g.value=[u,...g.value.slice(0,j-1)]}},removeResultHistory:r=>{g.value=[...g.value.slice(0,r),...g.value.slice(r+1)]}}),ke=t=>{const r=ve(),u=M(),k=de(),n=S(0),E=C(()=>n.value>0),v=he([]);return ye(()=>{const{search:x,terminate:h}=me(),f=pe(y=>{const{resultsFilter:B=l=>l,querySplitter:m,suggestionsFilter:L,...i}=r.value;y?(n.value+=1,x(y,u.value,i).then(l=>B(l,y,u.value,k.value)).then(l=>{n.value-=1,v.value=l}).catch(l=>{console.warn(l),n.value-=1,n.value||(v.value=[])})):v.value=[]},R.searchDelay-R.suggestDelay,{maxWait:5e3});U([t,u],([y])=>{f(y.join(" "))},{immediate:!0}),ge(()=>{h()})}),{isSearching:E,results:v}};var Be=X({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:r}){const u=Z(),k=M(),n=ee(se),{addQueryHistory:E,queryHistories:v,removeQueryHistory:x}=He(),{resultHistories:h,addResultHistory:f,removeResultHistory:y}=Re(),B=ae(t,"queries"),{results:m,isSearching:L}=ke(B),i=le({isQuery:!0,index:0}),l=S(0),d=S(0),$=C(()=>v.value.length>0||h.value.length>0),Q=C(()=>m.value.length>0),q=C(()=>m.value[l.value]||null),P=()=>{const{isQuery:e,index:s}=i;s===0?(i.isQuery=!e,i.index=e?h.value.length-1:v.value.length-1):i.index=s-1},Y=()=>{const{isQuery:e,index:s}=i;s===(e?v.value.length-1:h.value.length-1)?(i.isQuery=!e,i.index=0):i.index=s+1},_=()=>{l.value=l.value>0?l.value-1:m.value.length-1,d.value=q.value.contents.length-1},z=()=>{l.value=l.value<m.value.length-1?l.value+1:0,d.value=0},G=()=>{d.value<q.value.contents.length-1?d.value+=1:z()},J=()=>{d.value>0?d.value-=1:_()},w=e=>e.map(s=>Ee(s)?s:a(s[0],s[1])),K=e=>{if(e.type==="customField"){const s=ce[e.index]||"$content",[c,H=""]=oe(s)?s[k.value].split("$content"):s.split("$content");return e.display.map(o=>a("div",w([c,...o,H])))}return e.display.map(s=>a("div",w(s)))},A=()=>{l.value=0,d.value=0,r("updateQuery",""),r("close")},V=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.queryHistory),v.value.map((e,s)=>a("div",{class:["slimsearch-result-item",{active:i.isQuery&&i.index===s}],onClick:()=>{r("updateQuery",e)}},[a(b,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),x(s)}})]))])),W=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.resultHistory),h.value.map((e,s)=>a(T,{to:e.link,class:["slimsearch-result-item",{active:!i.isQuery&&i.index===s}],onClick:()=>{A()}},()=>[a(b,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(c=>w(c)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(s)}})]))]));return te("keydown",e=>{if(t.isFocusing){if(Q.value){if(e.key==="ArrowUp")J();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const s=q.value.contents[d.value];E(t.queries.join(" ")),f(s),u.push(F(s)),A()}}else if(e.key==="ArrowUp")P();else if(e.key==="ArrowDown")Y();else if(e.key==="Enter"){const{index:s}=i;i.isQuery?(r("updateQuery",v.value[s]),e.preventDefault()):(u.push(h.value[s].link),A())}}}),U([l,d],()=>{document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active")?.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:t.queries.length?!Q.value:!$.value}],id:"slimsearch-results"},t.queries.length?L.value?a(ie,{hint:n.value.searching}):Q.value?a("ul",{class:"slimsearch-result-list"},m.value.map(({title:e,contents:s},c)=>{const H=l.value===c;return a("li",{class:["slimsearch-result-list-item",{active:H}]},[a("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((o,N)=>{const D=H&&d.value===N;return a(T,{to:F(o),class:["slimsearch-result-item",{active:D,"aria-selected":D}],onClick:()=>{E(t.queries.join(" ")),f(o),A()}},()=>[o.type==="text"?null:a(o.type==="title"?re:o.type==="heading"?ue:ne,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[o.type==="text"&&o.header?a("div",{class:"content-header"},o.header):null,a("div",K(o))])])})])})):n.value.emptyResult:$.value?[V(),W()]:n.value.emptyHistory)}});export{Be as default};
